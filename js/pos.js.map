{"version":3,"sources":["../jsx/pos.js"],"names":["Pos","React","createClass","getInitialState","pendingOrderCount","itemList","searchReset","hasItem","productNo","variantNo","result","state","forEach","item","itemAddHandler","variant","newVariantList","oldVariantList","push","console","log","oldVariant","i","index","findIndex","quantity","selectedQuantity","updatedVariant","addons","update","$set","command","$splice","bind","concat","setState","handleCounterKeyAction","reset","number","minusPlus","removeItem","backspace","length","targetQuantity","temp","parseInt","substring","resetPos","resetCallback","render","radarStyle","display","props","branchName"],"mappings":"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","file":"pos.js","sourcesContent":["var Pos = React.createClass({\r\n    getInitialState: function() {\r\n        return {\r\n            pendingOrderCount: 0,\r\n            itemList: [],\r\n            searchReset: false\r\n        };\r\n    },\r\n\r\n    hasItem: function(productNo, variantNo) {\r\n        var result = false;\r\n        this.state.itemList.forEach(function(item){\r\n           if (item.productNo == productNo && item.variantNo == variantNo) {\r\n               result = true;\r\n               return true;\r\n           }\r\n        });\r\n\r\n        return result;\r\n    },\r\n\r\n    itemAddHandler: function(variant){\r\n        var newVariantList = [];\r\n        var oldVariantList = [];\r\n\r\n\r\n        if (!this.hasItem(variant.productNo, variant.variantNo)) {\r\n\r\n            newVariantList.push(variant)\r\n        } else {\r\n            console.log('old item');\r\n\r\n            oldVariantList.push(variant)\r\n        }\r\n\r\n        console.log('newVariantList:%O, oldVariantList:%O', newVariantList, oldVariantList);\r\n\r\n        var itemList = this.state.itemList;\r\n\r\n        //old items\r\n        oldVariantList.forEach(function(oldVariant, i){\r\n            var index = this.state.itemList.findIndex(function(item){\r\n                return item.productNo == oldVariant.productNo && item.variantNo == oldVariant.variantNo;\r\n            });\r\n\r\n            var quantity = this.state.itemList[index].selectedQuantity + oldVariant.selectedQuantity;\r\n\r\n            var updatedVariant = React.addons.update(itemList[index],\r\n                {selectedQuantity: {$set: quantity}});\r\n\r\n            var command = {$splice: [[index, 1, updatedVariant]]};\r\n            itemList = React.addons.update(itemList, command);\r\n\r\n        }.bind(this));\r\n\r\n        //new items\r\n        itemList = itemList.concat(newVariantList);\r\n\r\n        this.setState({\r\n            itemList: itemList\r\n        });\r\n\r\n    },\r\n\r\n    handleCounterKeyAction: function(index, reset, number, minusPlus, removeItem, backspace){\r\n        console.log('index: %O, reset:%O, number:%O, minusPlus:%O, removeItem:%O, backspace:%O', index, reset, number, minusPlus, removeItem, backspace);\r\n\r\n        if (this.state.itemList.length > 0 && index > -1 && index < this.state.itemList.length) {\r\n            var itemList = this.state.itemList;\r\n\r\n            if (removeItem) {\r\n                var command = {$splice: [[index, 1]]};\r\n\r\n                this.setState({\r\n                    itemList: React.addons.update(itemList, command)\r\n                });\r\n\r\n            } else {\r\n                var targetQuantity = itemList[index].selectedQuantity;\r\n\r\n                if (number > -1 && reset) {\r\n                    targetQuantity = number;\r\n                } else if (number > -1 && !reset) {\r\n                    if (targetQuantity > 0) {\r\n                        var temp = targetQuantity +  '' + number;\r\n                        temp = parseInt(temp);\r\n\r\n                        if (temp <= 10000) {\r\n                            targetQuantity = temp;\r\n                        }\r\n                    } else if (targetQuantity == 0) {\r\n                        targetQuantity = number;\r\n                    }\r\n                }\r\n\r\n                if (backspace) {\r\n                    if (targetQuantity <= 9) {\r\n                        targetQuantity = 0;\r\n                    } else {\r\n                        targetQuantity = targetQuantity + '';\r\n                        targetQuantity = targetQuantity.substring(0, targetQuantity.length - 1);\r\n                        targetQuantity = parseInt(targetQuantity);\r\n                    }\r\n                }\r\n\r\n                if (minusPlus > 0) {\r\n                    targetQuantity = targetQuantity + 1;\r\n\r\n                    if (targetQuantity > 10000) {\r\n                        targetQuantity = 10000;\r\n                    }\r\n                }\r\n                if (minusPlus < 0) {\r\n                    targetQuantity = targetQuantity - 1;\r\n\r\n                    if (targetQuantity < 1) {\r\n                        targetQuantity = 1;\r\n                    }\r\n                }\r\n\r\n                var updatedVariant = React.addons.update(itemList[index],\r\n                    {selectedQuantity: {$set: targetQuantity}});\r\n\r\n                var command = {$splice: [[index, 1, updatedVariant]]};\r\n\r\n                this.setState({\r\n                    itemList: React.addons.update(itemList, command)\r\n                });\r\n            }\r\n        }\r\n    },\r\n\r\n    resetPos: function(){\r\n        console.log('reset true');\r\n        this.setState({\r\n            itemList: [],\r\n            searchReset: true\r\n        });\r\n\r\n        /*console.log('reset false');\r\n        this.setState({\r\n            searchReset: false\r\n        });*/\r\n    },\r\n\r\n    resetCallback: function(){\r\n        this.setState({\r\n            searchReset: false\r\n        });\r\n    },\r\n\r\n    render: function(){\r\n        var radarStyle = (this.state.pendingOrderCount > 0) ? {display: 'block'} : {display: 'none'};\r\n        return (\r\n            <div>\r\n                <PosCounter itemList={this.state.itemList} printCallback={this.resetPos} branchName={this.props.branchName} counterKeyActionCallback={this.handleCounterKeyAction} />\r\n\r\n                <div className=\"mm-pos-container\">\r\n                    <div className=\"header\">\r\n                        <div className=\"radar\">\r\n                            <div className=\"radar-count\" style={radarStyle}>{this.state.pendingOrderCount}</div>\r\n                            <div className=\"radar-icon\"><i className=\"fa fa-wifi\"></i></div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"content\">\r\n                        <ProductSearchArea itemAddCallback={this.itemAddHandler} reset={this.state.searchReset} resetCallback={this.resetCallback} />\r\n                    </div>\r\n\r\n                    <div className=\"footer\">\r\n                        <ul className=\"footer-help\">\r\n                            <li><span className=\"help-badge\">F1</span> <span className=\"help-text\">Сагс</span></li>\r\n                            <li><span className=\"help-badge\">F2</span> <span className=\"help-text\">Хайлт</span></li>\r\n                            <li><span className=\"help-badge\">F10</span> <span className=\"help-text\">Тооцоо хийх</span></li>\r\n                        </ul>\r\n                    </div>\r\n\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n});\r\n\r\n"]}